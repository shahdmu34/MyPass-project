<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <title>Term project registration page</title>
    <link rel="stylesheet" type="text/css" href="css/index_style.css" />
</head>
<body>

<header>
    <h1 class="title">MyPass</h1>

</header>

<div class="contianer">
    <form>
        <div class="conatiner-uth">
            <h1>Register Account</h1>

            <div class="userInput">
                <input type="email" id="email" placeholder="Enter Email Address" required>
            </div>

            <div class="userInput">
                <p>Security Questions</p>
                <input type="text" id="questions-1" placeholder="Favorite Childhood Toy or Game:" required>
                <input type="text" id="questions-2" placeholder="Dream Vacation Destination:" required>
                <input type="text" id="questions-3" placeholder="First Job or Company:" required>


            </div>


            <div class="userInput">
                <input type="text" id="password" placeholder="Enter Password" required>
                <button type="button" id="generatePasswordBtn">Generate Password</button>
            </div>

            <div class="user-input">
                <button type="button" id="submitBtn" name="submitBtn" class="registeration-btn">Registar Account</button>
            </div>

            <div class="login-continer">
                <p>Already have an account?  <a href="login.html">Log In here!</a></p>
            </div>


        </div>
    </form>
</div>

</body>

<script type="module">
    //-------------Password Generator Segment-------------
    //Builder
    class PasswordBuilder {
        setLength(length) {

        }

        includeUppercase() {

        }

        includeLowercase() {

        }

        includeNumbers() {

        }

        includeSpecialCharacters() {

        }

        GetResult() {}

    }

    //Concrete Builders
    //Easy only incorporates uppercase and lower case letters
    class Easy extends PasswordBuilder {
        password = new Password;

        setLength(length) {
            this.password.length = length;
        }

        includeUppercase() {
            this.password.includeUppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        }

        includeLowercase() {
            this.password.includeLowercase = "abcdefghijklmnopqrstuvwxyz";
        }

        includeNumbers() {
            this.password.includeNumbers = "";
        }

        includeSpecialCharacters() {
            this.password.includeSpecialCharacters = "";
        }

        GetResult() {
            return this.password;
        }
    }

    //Medium includes uppercase and lower case letters with numbers
    class Medium extends PasswordBuilder {
        password = new Password;

        setLength(length) {
            this.password.length = length;
        }

        includeUppercase() {
            this.password.includeUppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        }

        includeLowercase() {
            this.password.includeLowercase = "abcdefghijklmnopqrstuvwxyz";
        }

        includeNumbers() {
            this.password.includeNumbers = "0123456789";
        }

        includeSpecialCharacters() {
            this.password.includeSpecialCharacters = "";
        }

        GetResult() {
            return this.password;
        }
    }

    //Hard includes upper and lower case letters, numbers, and special characters
    class Hard extends PasswordBuilder {
        password = new Password;

        setLength(length) {
            this.password.length = length;
        }

        includeUppercase() {
            this.password.includeUppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        }

        includeLowercase() {
            this.password.includeLowercase = "abcdefghijklmnopqrstuvwxyz";
        }

        includeNumbers() {
            this.password.includeNumbers = "0123456789";
        }

        includeSpecialCharacters() {
            this.password.includeSpecialCharacters = "!@#$%^&*()-_+=<>?";
        }

        GetResult() {
            return this.password;
        }
    }

    // Product
    class Password {
        length;
        includeUppercase;
        includeLowercase;
        includeNumbers;
        includeSpecialCharacters;

        show() {
            let password = "";
            let charset = this.includeUppercase + this.includeLowercase + this.includeNumbers + this.includeSpecialCharacters;

            for (let i = 0; i < this.length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                password += charset.charAt(randomIndex);
            }

            return password;
        }
    }

    //Director
    class PasswordGenerator {
        generate(passwordInstance, length) {
            let pass = new Hard();
            pass = passwordInstance;
            pass.setLength(length);
            pass.includeUppercase();
            pass.includeLowercase();
            pass.includeNumbers();
            pass.includeSpecialCharacters();
        }
    }

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
    import { getAuth,createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
    import { getDatabase, set, ref} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAaJ0fhXXd_WEuTwUTQJpa211weqA7ZQ6w",
        authDomain: "term-project-476.firebaseapp.com",
        projectId: "term-project-476",
        storageBucket: "term-project-476.appspot.com",
        messagingSenderId: "276408407460",
        appId: "1:276408407460:web:b05ec30e174fb0c3441d31"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    //initialize user authantication
    const auth = getAuth(app);
    //intilize database
    const database = getDatabase(app);

    const submitBtn = document.getElementById('submitBtn');
    const generatePasswordBtn = document.getElementById('generatePasswordBtn');
    const passwordInput = document.getElementById('password');

    generatePasswordBtn.addEventListener('click', () => {
        // Create PasswordGenerator and Password Builders that is dependent on difficulty
        let generator = new PasswordGenerator();
        let pass = new Hard(); //custom difficulty will be implemented later. it will be much like LastPass

        console.log("Button clicked");
        generator.generate(pass, 12); // custom length will be implemented later.
        let passwordComplete = pass.GetResult();

        passwordInput.value = passwordComplete.show();
    });

    submitBtn.addEventListener('click', (e) =>{

        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;
        createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                // Signed up
                const user = userCredential.user;

                set(ref(database,'Users/' + user.uid), {
                    email: email,
                    password:password

                })
                    .then(() =>{
                        alert('User created!');
                        window.location.href = "login.html";
                        //user was created
                    })
                    .catch((error) => {
                        alert(errorMessage);
                        //error in creating user
                    });

            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                alert(errorMessage)
            });
    })


</script>
</html>